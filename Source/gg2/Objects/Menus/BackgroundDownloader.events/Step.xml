<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event category="STEP" id="0">
  <actions>
    <action id="603" library="1">
      <!--action name: Code-->
      <kind>CODE</kind>
      <allowRelative>false</allowRelative>
      <question>false</question>
      <canApplyTo>true</canApplyTo>
      <actionType>CODE</actionType>
      <functionName/>
      <relative>false</relative>
      <not>false</not>
      <appliesTo>.self</appliesTo>
      <arguments>
        <argument kind="STRING">// Finished
if (DM_DownloadStatus(handle) == 3)
{
    DM_StopDownload(handle);
    DM_CloseDownload(handle);

    // Download failed (presumably)
    if (!file_exists(tmpfile))
    {
        // ignore
    }
    else
    {
        // Delete existing background
        if (file_exists("background.png"))
        {
            file_delete("background.png");
        }

        // Move tempfile
        file_copy(tmpfile, "background.png");
        file_delete(tmpfile);

        // Update Globals &amp; INI
        global.backgroundVersion = version;
        global.backgroundTitle = title;
        ini_open("gg2.ini");
        ini_write_string("Background", "BackgroundVersion", global.backgroundVersion);
        ini_write_string("Background", "BackgroundTitle", global.backgroundTitle);
        ini_close();

        // Make main menu controller reload
        with (MainMenuController)
        {
            event_user(1);
        }

        instance_destroy();
    }
}
</argument>
      </arguments>
    </action>
  </actions>
</event>

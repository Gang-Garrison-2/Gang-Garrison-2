<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event category="CREATE" id="0">
  <actions>
    <action id="603" library="1">
      <!--action name: Code-->
      <kind>CODE</kind>
      <allowRelative>false</allowRelative>
      <question>false</question>
      <canApplyTo>true</canApplyTo>
      <actionType>CODE</actionType>
      <functionName/>
      <relative>false</relative>
      <not>false</not>
      <appliesTo>.self</appliesTo>
      <arguments>
        <argument kind="STRING">{
    global.levelchoice = 1
    menu_create(40, 300, 200, 200, 32);
    
    menu_background(208, 24, 8, 12, 4);
    
    menu_addlink("Host Game", 'event_user(0);');
    menu_addlink("Join (lobby)", '
        room_goto_fix(Lobby);
    ');
    menu_addlink("Join (manual)", '
        global.isHost = false;
        global.serverIP = get_string("Please enter the IP address or hostname of the server you want to join", "127.0.0.1");
        global.serverPort = get_integer("Please enter the port of the server you want to join", 8190);
        instance_create(0,0,Client);
        Client.returnRoom = Menu;
    ');
    menu_addlink("Garrison Builder", '
        room_goto_fix(BuilderOptions);
    ');
    menu_addlink("Options", '
        room_goto_fix(Options);
    ');
    if (global.rewardId != '')
    {
        menu_addlink("Manage Haxxy Rewards", '
            splash_set_main(false);
            splash_set_interrupt(false);
            splash_show_web("http://www.ganggarrison.com/forums/rewards/frame.php?gg2_login=yes&amp;reward_id=" + global.rewardId + "&amp;reward_key=" + hex(global.rewardKey), 0);
        ');
    }
    menu_addlink("Credits", '
        room_goto_fix(Credits);
    ');
    menu_addlink("Visit The Forums",'
        action_splash_web("http://www.ganggarrison.com/forums/index.php", 1)
    ');
    menu_addback("Quit", '
        game_end();
    ');

    // Music setting set to "Menu Only" or "Menu and In-Game"
    //select a random song
    global.MenuMusic = faudio_new_generator(ds_list_find_value(global.MenuMusicS, irandom(ds_list_size(global.MenuMusicS) - 1)));
    if(global.music == MUSIC_MENU_ONLY || global.music == MUSIC_BOTH)
    {
        
        if(global.MenuMusic != -1)
        {
            if(faudio_get_generator_playing(global.MenuMusic) != 1)
            {
                faudio_volume_generator(global.MenuMusic, 0.8);     
                AudioControlPlaySong(global.MenuMusic);
            }
        }
    }
        
    fade = 0;
    
    // ini says we have a downloaded background
    if (global.backgroundHash != "default")
    {
        var validBackground;
        validBackground = false;

        // already loaded background in a previous instance
        if (variable_global_exists("downloadedBackground"))
        {
            menuimage = global.downloadedBackground;
            validBackground = true;
        }
        // haven't loaded yet, background exists
        else if (file_exists("background.png"))
        {
            // passes integrity check
            if (global.backgroundHash == GG2DLL_compute_MD5("background.png"))
            {
                // use downloaded background
                global.downloadedBackground = background_add("background.png", false, false);
                menuimage = global.downloadedBackground;
                validBackground = true;
            }
        }
        // otherwise, reset values
        if (!validBackground)
        {
            global.backgroundHash = "default";
            global.backgroundTitle = "";
            global.backgroundURL = "";
            global.backgroundShowVersion = true;
            ini_open("gg2.ini");
            ini_write_string("Background", "BackgroundHash", global.backgroundHash);
            ini_write_string("Background", "BackgroundTitle", global.backgroundTitle);
            ini_write_string("Background", "BackgroundURL", global.backgroundURL);
            ini_write_real("Background", "BackgroundShowVersion", global.backgroundShowVersion);
            ini_close();
        }
    }

    // use default background if ini says we should
    if (global.backgroundHash == "default")
        menuimage = global.defaultBackground;

    if(global.dedicatedMode == 1)
        event_user(0);
}
</argument>
      </arguments>
    </action>
  </actions>
</event>
